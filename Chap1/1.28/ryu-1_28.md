## フェルマーの小定理

### 定理

a^n-1 ≡ 1 (mod n)

- n
  - 素数
- a
  - 1 < a =< n (ランダムな値)

### 実際にみてみる

3^4(mod 5) をみてみる

3^4 = 81
81 ≡ 1 (mod 5)

5は素数なので1になる。


3^8 (mod 9) をみてみる

19683 ≡ 0 (mod 9)

9は素数ではないのでフェルマーの小定理が成り立たない。

### expmodでみてみる

```lisp
(expmod 3 4 5)
; 3^4 (mod 5)
; (even? 4) -> #t
; (expmod 3 4 5) -> (remainder (square (expmod 3 2 5)) 5)
(remainder (square (expmod 3 2 5)) 5)
; (expmod 3 2 5) -> (remainder (square (expmod 3 1 5)) 5)
(remainder (square (remainder (square (expmod 3 1 5)) 5)) 5)
; (expmod 3 1 5) -> (remainder (* 3 (expmod 3 0 5)) 5)
(remainder (square (remainder (square (remainder (* 3 (expmod 3 0 5)) 5)) 5)) 5)
; (expmod 3 0 5) -> 1
(remainder (square (remainder (square (remainder (* 3 1) 5)) 5)) 5)
; ((((((3 * 1) % 5)^2) % 5)^2) % 5)
```

3^0 ≡ 1 (mod 5)
3^1 ≡ 3 (mod 5)
3 * 1 = 3
3^2 = 9
9 ≡ 4 (mod 5)
4^2 = 16
16 ≡ 1 (mod 5)

> [!note]
> 途中でmodしても良い

## 自明でない平方根とは

> expmodで二乗を計算しながら「nを法とした1の自明でない平方根」, つまり1でもn - 1でもないがその二乗がnを法として1になる数がなかったか調べる.

素数の場合、n-1、n以外のは2上をした値のあまりが1にならない

↓

素数でない場合、n-1、n以外のときにもあまりが1になる

下の2つを定義する

- x（`(expmod base (/ exp 2) m)`）
- y（`x^2`）

y=1 になるときに、 x が、m（n）, m-1（n-1）でない場合は素数ではないと判断する。

例えば、5と9、15でどういう動きをするかを見てみる。

5は素数なので、xが1とx-1（4）のときだけ1になっている（0にもならない）。

9は素数ではないので、x=6で0になる。

15は素数ではないので、x=4で1がでる。

| x  | \( y = x^2 \) | \( mod 5 \) | \( mod 9 \) | \( mod 15 \) |
|----|---------------|------------------------|------------------------|------------------------|
| 1  | 1             | 1 ≡ 1 (mod 5)         | 1 ≡ 1 (mod 9)         | 1 ≡ 1 (mod 15)         |
| 2  | 4             | 4 ≡ 4 (mod 5)         | 4 ≡ 4 (mod 9)         | 4 ≡ 4 (mod 15)         |
| 3  | 9             | 9 ≡ 4 (mod 5)         | 9 ≡ 0 (mod 9)         | 9 ≡ 9 (mod 15)         |
| 4  | 16            | 16 ≡ 1 (mod 5)        | 16 ≡ 7 (mod 9)        | 16 ≡ 1 (mod 15)        |
| 5  | 25            | 25 ≡ 0 (mod 5)        | 25 ≡ 7 (mod 9)        | 25 ≡ 10 (mod 15)       |
| 6  | 36            |                        | 36 ≡ 0 (mod 9)        | 36 ≡ 6 (mod 15)        |
| 7  | 49            |                        | 49 ≡ 4 (mod 9)        | 49 ≡ 4 (mod 15)        |
| 8  | 64            |                        | 64 ≡ 1 (mod 9)        | 64 ≡ 4 (mod 15)        |
| 9  | 81            |                        | 81 ≡ 0 (mod 9)        | 81 ≡ 6 (mod 15)        |
| 10 | 100           |                        |                         | 100 ≡ 10 (mod 15)      |
| 11 | 121           |                        |                         | 121 ≡ 1 (mod 15)       |
| 12 | 144           |                        |                         | 144 ≡ 9 (mod 15)       |
| 13 | 169           |                        |                         | 169 ≡ 4 (mod 15)       |
| 14 | 196           |                        |                         | 196 ≡ 1 (mod 15)       |
| 15 | 225           |                        |                         | 225 ≡ 0 (mod 15)       |

## ミラー–ラビンテストの失敗確率

10回試行すればだいたいいい感じになるっぽい。

> ミラー–ラビンテストが合成数を見逃す確率は、ランダムに選ばれた  a  に対して最大でも  1/4  です。複数回テストを繰り返せば、その確率はさらに減少し、10 回のテストで失敗する確率はおおよそ  10^{-6}  になります。

https://learning.oreilly.com/library/view/introduction-to-cryptography/9780136758181/xhtml/fileP70010167750000000000000000014F3.xhtml#:-:text=It%20can%20be,is%20fairly%20accurate.
